<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Splitter</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      text-align: center;
    }
    .pdf-container {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
    canvas {
      border: 1px solid #ddd;
      margin: 5px;
    }
    .controls {
      margin: 20px 0;
    }
    input {
      margin: 5px;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
</head>
<body>
  <h1>PDF Splitter</h1>
  <input type="file" id="pdfUpload" accept="application/pdf">
  <div class="controls">
    <label for="startPage">First Page:</label>
    <input type="number" id="startPage" min="1" placeholder="e.g., 1">
    <label for="endPage">Last Page:</label>
    <input type="number" id="endPage" min="1" placeholder="e.g., 3">
    <button id="splitButton">Split PDF</button>
  </div>
  <div class="pdf-container" id="pdfPreview"></div>
  <script>
    const pdfUpload = document.getElementById("pdfUpload");
    const splitButton = document.getElementById("splitButton");
    const startPage = document.getElementById("startPage");
    const endPage = document.getElementById("endPage");
    const pdfPreview = document.getElementById("pdfPreview");

    let uploadedPdfBytes = null;

    pdfUpload.addEventListener("change", async (event) => {
      const file = event.target.files[0];
      if (file) {
        uploadedPdfBytes = await file.arrayBuffer();
        renderPdf(uploadedPdfBytes);
      }
    });

    splitButton.addEventListener("click", async () => {
      if (!uploadedPdfBytes) {
        alert("Please upload a PDF first.");
        return;
      }
      const start = parseInt(startPage.value, 10);
      const end = parseInt(endPage.value, 10);
      if (isNaN(start) || isNaN(end) || start > end) {
        alert("Please provide valid page range.");
        return;
      }
      const splitPdfBytes = await splitPdf(uploadedPdfBytes, start, end);
      renderPdf(splitPdfBytes);
    });

    async function renderPdf(pdfBytes) {
      const loadingTask = pdfjsLib.getDocument({ data: pdfBytes });
      const pdf = await loadingTask.promise;
      pdfPreview.innerHTML = ""; // Clear previous previews

      for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
        const page = await pdf.getPage(pageNum);
        const canvas = document.createElement("canvas");
        const context = canvas.getContext("2d");
        const viewport = page.getViewport({ scale: 1 });
        canvas.width = viewport.width;
        canvas.height = viewport.height;

        await page.render({ canvasContext: context, viewport }).promise;
        pdfPreview.appendChild(canvas);
      }
    }

    async function splitPdf(pdfBytes, startPage, endPage) {
      const pdfDoc = await PDFLib.PDFDocument.load(pdfBytes);
      const newPdf = await PDFLib.PDFDocument.create();

      for (let i = startPage - 1; i < endPage; i++) {
        const [copiedPage] = await newPdf.copyPages(pdfDoc, [i]);
        newPdf.addPage(copiedPage);
      }
      return await newPdf.save();
    }
  </script>
</body>
</html>
